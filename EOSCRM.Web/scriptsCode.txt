
	create procedure [dbo].[Get_DuongPho_ByAll]
	create procedure [dbo].[Get_DSTongHopKHDK_ByKVToNgay]	
	create procedure [dbo].[Get_DSTongHopKHDKPO_ByKVToNgay]
	create procedure [dbo].[Get_HisNgayDangKy_ByMaDDKMoTaTTDON]
	create procedure [dbo].[Get_HopDong_ByMaddk]
	create procedure [dbo].[Update_HopDong_GhiChu]

	update procedure [dbo].[BienKHNuoc]
	update procedure [dbo].[dsKHCBiKT]
	update procedure [dbo].[DSKHMOIDOTIN]	
	update procedure [dbo].[DSTHAYDOICHITIETNUOC]
	updare procedure [dbo].[DSTHAYDOICHITIETNUOCLX]
	update procedure [dbo].[DSTHAYDOICHITIETNUOCDOTIN]
	update procedure [dbo].[HisBienCo]
	update procedure [dbo].[HisNgayDangKyBien]
	update procedure [dbo].[RP_THAYDONGHO]
	update procedure [dbo].[RP_THAYDONGHO_DOTIN]	



	delete Database in table DMDOTINHD all column Thu ho hoac nho thu... 
		delete DMDOTINHD where MADOTIN='NNNTD1' or MADOTIN='NNTHD1'
		delete DOTINHD where IDMADOTIN='NNIN0301' or IDMADOTIN='NNIN0304' or IDMADOTIN='NNIN0401' or IDMADOTIN='NNIN0404' 
			or IDMADOTIN='NNIN0501'	or IDMADOTIN='NNIN0504'

	inserts Database in table: for 11 khuvuc, only update table DOTINHD columns MADOTIN 
		insert into DOTINHD ([IDMADOTIN], [MADOTIN], [MAKV], [MAKVPO] , [MANVN], [NGAYN] , [STT] , [NGAYBT], [NGAYKT], [GHICHU])
		vlaues ('NNIN1111',	'NN1TMD',	'Q',	'Q',	'admin',	'2020-10-26 00:00:00.000',	1,	'2016-01-01',	'2016-01-06',	NULL)
		values ('NNIN1112',	'NN1TMD',	'M',	'M',	'admin',	'2020-10-26 00:00:00.000',	1,	'2016-01-01',	'2016-01-06',	NULL)
		values ('NNIN1113',	'NN1TMD',	'L',	'L',	'admin',	'2020-10-26 00:00:00.000',	1,	'2016-01-01',	'2016-01-06',	NULL)

		insert into DMDOTINHD ( MADOTIN, TENDONIN, MANVN, NGAYN, STT, IntMucDichKhac )
		values ( 'NN1TMD', 'Đợt 1 (Mục đích khác)', '2020-10-26', 'admin', 1, 1) 
		values ( 'NNDLX4', 'A1, A2 (Đợt 1)', '2020-10-26', 'admin', 1, NULL) 
		values ( 'NNDLX5', '1, 2  (Đợt 2)', '2020-10-26', 'admin', 1, NULL) 
		values ( 'NNDLX6', '3, 4  (Đợt 3)', '2020-10-26', 'admin', 1, NULL) 
		values ( 'NNDLX7', '5, 6  (Đợt 4)', '2020-10-26', 'admin', 1, NULL) 

	update Database in table DMDOTINHD inserts Column: IntMucDichKhac (int)
	update Database in table HOPDONG inserts Column: GhiChu nvarchar(1000), Manv varchar(11)
	update Database in table HISNGAYDANGKY inserts Column: SoNgay (int) and
		update  HISNGAYDANGKY set SoNgay = (SELECT (DATEDIFF(dd, d.NGAYDK, d.NGAYHKS) + 1) 
			- (DATEDIFF(wk, d.NGAYDK, d.NGAYHKS) * 2) 
			- (CASE WHEN DATENAME(dw, d.NGAYDK) = 'Sunday' THEN 1 ELSE 0 END)
			- (CASE WHEN DATENAME(dw, d.NGAYHKS) = 'Saturday' THEN 1 ELSE 0 END))
		from HISNGAYDANGKY hi inner join DONDANGKY d on hi.MADDK = d.MADDK
		where MOTATTDON = 'DUYETDONDANGKY'

		update  HISNGAYDANGKY set SoNgay = (SELECT (DATEDIFF(dd, d.NGAYHKS, tk.NGAYDTK) + 1) 
			- (DATEDIFF(wk, d.NGAYHKS, tk.NGAYDTK) * 2) 
			- (CASE WHEN DATENAME(dw, d.NGAYHKS) = 'Sunday' THEN 1 ELSE 0 END)
			- (CASE WHEN DATENAME(dw, tk.NGAYDTK) = 'Saturday' THEN 1 ELSE 0 END))
		from HISNGAYDANGKY hi inner join THIETKE tk on hi.MADDK = tk.MADDK 
			inner join DONDANGKY d on tk.MADDK = d.MADDK
		where hi.MOTATTDON = 'DUYETTHIETKE'

		update  HISNGAYDANGKY set SoNgay = 1
		from HISNGAYDANGKY hi inner join THIETKE tk on hi.MADDK = tk.MADDK 
			inner join DONDANGKY d on tk.MADDK = d.MADDK
		where tk.NGAYDTK < d.NGAYHKS and MOTATTDON = 'DUYETTHIETKE'

		update  HISNGAYDANGKY set SoNgay = (SELECT (DATEDIFF(dd, tk.NGAYDTK, ct.NGAYN) + 1) 
			- (DATEDIFF(wk, tk.NGAYDTK, ct.NGAYN) * 2) 
			- (CASE WHEN DATENAME(dw, tk.NGAYDTK) = 'Sunday' THEN 1 ELSE 0 END)
			- (CASE WHEN DATENAME(dw, ct.NGAYN) = 'Saturday' THEN 1 ELSE 0 END))
		from HISNGAYDANGKY hi inner join THIETKE tk on hi.MADDK = tk.MADDK 
			inner join CHIETTINH ct on tk.MADDK = ct.MADDK
		where hi.MOTATTDON = 'DUYETCTKH'

		update  HISNGAYDANGKY set SoNgay = (SELECT (DATEDIFF(dd, ct.NGAYN, hd.NGAYTAO) + 1) 
			- (DATEDIFF(wk, ct.NGAYN, hd.NGAYTAO) * 2) 
			- (CASE WHEN DATENAME(dw, ct.NGAYN) = 'Sunday' THEN 1 ELSE 0 END)
			- (CASE WHEN DATENAME(dw, hd.NGAYTAO) = 'Saturday' THEN 1 ELSE 0 END))
		from HISNGAYDANGKY hi inner join CHIETTINH ct on hi.MADDK = ct.MADDK
			inner join HOPDONG hd on ct.MADDK = hd.MADDK
		where hi.MOTATTDON = 'INHOPDONG'

		update  HISNGAYDANGKY set SoNgay = (SELECT (DATEDIFF(dd, hd.NGAYTAO, tc.NGAYHT) + 1) 
			- (DATEDIFF(wk, hd.NGAYTAO, tc.NGAYHT) * 2) 
			- (CASE WHEN DATENAME(dw, hd.NGAYTAO) = 'Sunday' THEN 1 ELSE 0 END)
			- (CASE WHEN DATENAME(dw, tc.NGAYHT) = 'Saturday' THEN 1 ELSE 0 END))
		from HISNGAYDANGKY hi inner join THICONG tc on hi.MADDK = tc.MADDK
			inner join HOPDONG hd on tc.MADDK = hd.MADDK
		where hi.MOTATTDON = 'DUYETTHICONG'

		update  HISNGAYDANGKY set SoNgay = (SELECT (DATEDIFF(dd, tc.NGAYHT, bb.NGAYLAPBB) + 1) 
			- (DATEDIFF(wk, tc.NGAYHT, bb.NGAYLAPBB) * 2) 
			- (CASE WHEN DATENAME(dw, tc.NGAYHT) = 'Sunday' THEN 1 ELSE 0 END)
			- (CASE WHEN DATENAME(dw, bb.NGAYLAPBB) = 'Saturday' THEN 1 ELSE 0 END))
		from HISNGAYDANGKY hi inner join THICONG tc on hi.MADDK = tc.MADDK
			inner join BBNGHIEMTHU bb on tc.MADDK = bb.MADDK
		where hi.MOTATTDON = 'INBBNT'


	updata Database table THIETKE, THIETKEPO => update THIETKE set NGAYLTK = NGAYN where ngayltk is null


	insert table in Database: BBNghiemThuHis
	insert Table in Database: ChietTinhHis
	insert Table in Database: HopDongHis
	insert Table in Database: HisNgayDangKyHis


	install .NET Framwork 4.6.1


	select 'Ok' as KetQua	

-- diff Saturday and sunday
DECLARE @StartDate DATETIME
DECLARE @EndDate DATETIME
SET @StartDate = '2020/10/29'
SET @EndDate = '2020/11/03'

SELECT (DATEDIFF(dd, @StartDate, @EndDate) + 1) 
	- (DATEDIFF(wk, @StartDate, @EndDate) * 2) 
	- (CASE WHEN DATENAME(dw, @StartDate) = 'Sunday' THEN 1 ELSE 0 END)
	- (CASE WHEN DATENAME(dw, @EndDate) = 'Saturday' THEN 1 ELSE 0 END)

	//DateTime tungay = DateTimeUtil.GetVietNamDate(txtTuNgay.Text.Trim());
            //DateTime denngay = DateTimeUtil.GetVietNamDate(txtDenNgay.Text.Trim());
            //if (tungay <= denngay)
            //{
            //    int songay = DateTimeUtil.CountDayDiffT7CN(tungay, denngay);
            //}
            //else 
            //{
            //    ShowError("Chọn từ ngày đến ngày cho đúng.");
            //}
            //CloseWaitingDialog();

	//lbSoNgayLamHoSo.Text = dondangky.NGAYDK != null && dondangky.NGAYHKS != null ?
                                //    Convert.ToString(DateTimeUtil.CountDayDiffT7CN(dondangky.NGAYDK ?? DateTime.Now,
                                //    dondangky.NGAYHKS ?? DateTime.Now)) : "0";


r2	create procedure [dbo].[Get_DuongPho_ByAll]
r2	create procedure [dbo].[Get_DSTongHopKHDK_ByKVToNgay]	
r2	create procedure [dbo].[Get_DSTongHopKHDKPO_ByKVToNgay]
 
r2	update procedure [dbo].[BienKHNuoc]
r2	update procedure [dbo].[dsKHCBiKT]
r2	update procedure [dbo].[DSKHMOIDOTIN]	
r2	update procedure [dbo].[DSTHAYDOICHITIETNUOC]
r2	update procedure [dbo].[DSTHAYDOICHITIETNUOCDOTIN]
r2	update procedure [dbo].[HisBienCo]



