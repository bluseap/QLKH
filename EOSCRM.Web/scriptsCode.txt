
	create procedure [dbo].[Get_DuongPho_ByAll]
	create procedure [dbo].[Get_DonDangKy_ByMaddk]
	create procedure [dbo].[Get_DSTongHopKHDK_ByDuyetCTKoTC]
	create procedure [dbo].[Get_DSTongHopKHDK_ByDuyetCTKoTCPo]

	create procedure [dbo].[Get_DSTongHopKHDK_ByKVToNgay]	
	create procedure [dbo].[Get_DSTongHopKHDK_ByKVToDung7Ngay]	
	create procedure [dbo].[Get_DSTongHopKHDK_ByKVToTre7Ngay]
	create procedure [dbo].[Get_DSTongHopKHDK_ByKVToDung7NgayPo]	
	create procedure [dbo].[Get_DSTongHopKHDK_ByKVToTre7NgayPo]	

	create procedure [dbo].[Get_DSTongHopKHDKPO_ByKVToNgay]	
	
	create procedure [dbo].[Get_HisNgayDangKy_ByMaDDKMoTaTTDON]
	create procedure [dbo].[Get_HisNgayDangKyPo_ByMaDDKMoTaTTDON]
	
	create procedure [dbo].[Get_HopDong_ByMaddk]
	create procedure [dbo].[Get_HopDongPo_ByMaddk]	

	create procedure [dbo].[Update_DonDangKy_SoDienThoai2MuaVatTu]
	create procedure [dbo].[Update_HopDong_GhiChu]
	create procedure [dbo].[Update_HopDongPo_GhiChu]
	

	update procedure [dbo].[BienKHNuoc]
	update procedure [dbo].[dsKHCBiKT]
	update procedure [dbo].[dsKHCBiKTPO]
	update procedure [dbo].[DSKHMOIDOTIN]	
	update procedure [dbo].[DSTDCTNLX]
	update procedure [dbo].[DSTHAYDOICHITIETDIEN]
	update procedure [dbo].[DSTHAYDOICHITIETNUOC]
	updare procedure [dbo].[DSTHAYDOICHITIETNUOCLX]
	update procedure [dbo].[DSTHAYDOICHITIETNUOCDOTIN]
	update procedure [dbo].[DSTHAYDOICTPODOTIN]
	update procedure [dbo].[DSTHAYDOICTPOP7D1]
	update procedure [dbo].[HisBienCo]
	update procedure [dbo].[HisNgayDangKyBien]
	update procedure [dbo].[HisNgayDangKyBienPo]
	update procedure [dbo].[RP_THAYDONGHO]
	update procedure [dbo].[RP_THAYDONGHO_DOTIN]	



	delete Database in table DMDOTINHD all column Thu ho hoac nho thu... 
		delete DMDOTINHD where MADOTIN='NNNTD1' or MADOTIN='NNTHD1'
		delete DOTINHD where IDMADOTIN='NNIN0301' or IDMADOTIN='NNIN0304' or IDMADOTIN='NNIN0401' or IDMADOTIN='NNIN0404' 
			or IDMADOTIN='NNIN0501'	or IDMADOTIN='NNIN0504'

	inserts Database in table: for 11 khuvuc, only update table DOTINHD columns MADOTIN 
		insert into DOTINHD ([IDMADOTIN], [MADOTIN], [MAKV], [MAKVPO] , [MANVN], [NGAYN] , [STT] , [NGAYBT], [NGAYKT], [GHICHU])
		vlaues ('NNIN1111',	'NN1TMD',	'Q',	'Q',	'admin',	'2020-10-26 00:00:00.000',	1,	'2016-01-01',	'2016-01-06',	NULL)
		values ('NNIN1112',	'NN1TMD',	'M',	'M',	'admin',	'2020-10-26 00:00:00.000',	1,	'2016-01-01',	'2016-01-06',	NULL)
		values ('NNIN1113',	'NN1TMD',	'L',	'L',	'admin',	'2020-10-26 00:00:00.000',	1,	'2016-01-01',	'2016-01-06',	NULL)

		insert into DMDOTINHD ( MADOTIN, TENDONIN, MANVN, NGAYN, STT, IntMucDichKhac )
		values ( 'NN1TMD', 'Đợt 1 (Mục đích khác)', '2020-10-26', 'admin', 1, 1) 
		values ( 'NNDLX4', 'A1, A2 (Đợt 1)', '2020-10-26', 'admin', 1, NULL) 
		values ( 'NNDLX5', '1, 2  (Đợt 2)', '2020-10-26', 'admin', 1, NULL) 
		values ( 'NNDLX6', '3, 4  (Đợt 3)', '2020-10-26', 'admin', 1, NULL) 
		values ( 'NNDLX7', '5, 6  (Đợt 4)', '2020-10-26', 'admin', 1, NULL) 


	update Database in table MAUBOCVATTU, update MAKV of Dien theo tung khu vuc Xi nghiep (huong dan cho Xi nghiep)

	update Database in table DONDANGKY inserts Column: SoDienThoai2 varchar(20)
	update Database in table DONDANGKY inserts Column: IsKHMuaVatTu (bit)
	update Database in table DMDOTINHD inserts Column: IntMucDichKhac (int)
	update Database in table HOPDONG inserts Column: GhiChu nvarchar(1000), Manv varchar(11)
	update Database in table HOPDONGPO inserts Column: GhiChu nvarchar(1000), Manv varchar(11)

	update Database in table HISNGAYDANGKY inserts Column: SoNgay (int) and
		update  HISNGAYDANGKY set SoNgay = (SELECT (DATEDIFF(dd, d.NGAYDK, d.NGAYHKS) + 1) 
			- (DATEDIFF(wk, d.NGAYDK, d.NGAYHKS) * 2) 
			- (CASE WHEN DATENAME(dw, d.NGAYDK) = 'Sunday' THEN 1 ELSE 0 END)
			- (CASE WHEN DATENAME(dw, d.NGAYHKS) = 'Saturday' THEN 1 ELSE 0 END))
		from HISNGAYDANGKY hi inner join DONDANGKY d on hi.MADDK = d.MADDK
		where MOTATTDON = 'DUYETDONDANGKY'

		update  HISNGAYDANGKY set SoNgay = (SELECT (DATEDIFF(dd, d.NGAYHKS, tk.NGAYDTK) + 1) 
			- (DATEDIFF(wk, d.NGAYHKS, tk.NGAYDTK) * 2) 
			- (CASE WHEN DATENAME(dw, d.NGAYHKS) = 'Sunday' THEN 1 ELSE 0 END)
			- (CASE WHEN DATENAME(dw, tk.NGAYDTK) = 'Saturday' THEN 1 ELSE 0 END))
		from HISNGAYDANGKY hi inner join THIETKE tk on hi.MADDK = tk.MADDK 
			inner join DONDANGKY d on tk.MADDK = d.MADDK
		where hi.MOTATTDON = 'DUYETTHIETKE'

		update  HISNGAYDANGKY set SoNgay = 1
		from HISNGAYDANGKY hi inner join THIETKE tk on hi.MADDK = tk.MADDK 
			inner join DONDANGKY d on tk.MADDK = d.MADDK
		where tk.NGAYDTK < d.NGAYHKS and MOTATTDON = 'DUYETTHIETKE'

		update  HISNGAYDANGKY set SoNgay = (SELECT (DATEDIFF(dd, tk.NGAYDTK, ct.NGAYN) + 1) 
			- (DATEDIFF(wk, tk.NGAYDTK, ct.NGAYN) * 2) 
			- (CASE WHEN DATENAME(dw, tk.NGAYDTK) = 'Sunday' THEN 1 ELSE 0 END)
			- (CASE WHEN DATENAME(dw, ct.NGAYN) = 'Saturday' THEN 1 ELSE 0 END))
		from HISNGAYDANGKY hi inner join THIETKE tk on hi.MADDK = tk.MADDK 
			inner join CHIETTINH ct on tk.MADDK = ct.MADDK
		where hi.MOTATTDON = 'DUYETCTKH'

		update  HISNGAYDANGKY set SoNgay = (SELECT (DATEDIFF(dd, ct.NGAYN, hd.NGAYTAO) + 1) 
			- (DATEDIFF(wk, ct.NGAYN, hd.NGAYTAO) * 2) 
			- (CASE WHEN DATENAME(dw, ct.NGAYN) = 'Sunday' THEN 1 ELSE 0 END)
			- (CASE WHEN DATENAME(dw, hd.NGAYTAO) = 'Saturday' THEN 1 ELSE 0 END))
		from HISNGAYDANGKY hi inner join CHIETTINH ct on hi.MADDK = ct.MADDK
			inner join HOPDONG hd on ct.MADDK = hd.MADDK
		where hi.MOTATTDON = 'INHOPDONG'

		update  HISNGAYDANGKY set SoNgay = 1
		from HISNGAYDANGKY hi inner join CHIETTINH ct on hi.MADDK = ct.MADDK
			inner join HOPDONG hd on ct.MADDK = hd.MADDK
		where hi.MOTATTDON = 'INHOPDONG' and hi.SoNgay < 0

		update  HISNGAYDANGKY set SoNgay = (SELECT (DATEDIFF(dd, hd.NGAYTAO, tc.NGAYHT) + 1) 
			- (DATEDIFF(wk, hd.NGAYTAO, tc.NGAYHT) * 2) 
			- (CASE WHEN DATENAME(dw, hd.NGAYTAO) = 'Sunday' THEN 1 ELSE 0 END)
			- (CASE WHEN DATENAME(dw, tc.NGAYHT) = 'Saturday' THEN 1 ELSE 0 END))
		from HISNGAYDANGKY hi inner join THICONG tc on hi.MADDK = tc.MADDK
			inner join HOPDONG hd on tc.MADDK = hd.MADDK
			inner join CHIETTINH ct on tc.MADDK = ct.MADDK
		where hi.MOTATTDON = 'DUYETTHICONG'

		update  HISNGAYDANGKY set SoNgay = (SELECT (DATEDIFF(dd, tc.NGAYHT, bb.NGAYLAPBB) + 1) 
			- (DATEDIFF(wk, tc.NGAYHT, bb.NGAYLAPBB) * 2) 
			- (CASE WHEN DATENAME(dw, tc.NGAYHT) = 'Sunday' THEN 1 ELSE 0 END)
			- (CASE WHEN DATENAME(dw, bb.NGAYLAPBB) = 'Saturday' THEN 1 ELSE 0 END))
		from HISNGAYDANGKY hi inner join THICONG tc on hi.MADDK = tc.MADDK
			inner join BBNGHIEMTHU bb on tc.MADDK = bb.MADDK
		where hi.MOTATTDON = 'INBBNT'

	update Database in table HISNGAYDANGKYPO inserts Column: SoNgay (int) and
		update  HISNGAYDANGKYPO set SoNgay = (SELECT (DATEDIFF(dd, d.NGAYDK, d.NGAYHKS) + 1) 
			- (DATEDIFF(wk, d.NGAYDK, d.NGAYHKS) * 2) 
			- (CASE WHEN DATENAME(dw, d.NGAYDK) = 'Sunday' THEN 1 ELSE 0 END)
			- (CASE WHEN DATENAME(dw, d.NGAYHKS) = 'Saturday' THEN 1 ELSE 0 END))
		from HISNGAYDANGKYPO hi inner join DONDANGKYPO d on hi.MADDKPO = d.MADDKPO
		where MOTATTDON = 'DUYETDONDANGKY'

		update  HISNGAYDANGKYPO set SoNgay = (SELECT (DATEDIFF(dd, d.NGAYHKS, tk.NGAYDTK) + 1) 
			- (DATEDIFF(wk, d.NGAYHKS, tk.NGAYDTK) * 2) 
			- (CASE WHEN DATENAME(dw, d.NGAYHKS) = 'Sunday' THEN 1 ELSE 0 END)
			- (CASE WHEN DATENAME(dw, tk.NGAYDTK) = 'Saturday' THEN 1 ELSE 0 END))
		from HISNGAYDANGKYPO hi inner join THIETKEPO tk on hi.MADDKPO = tk.MADDKPO 
			inner join DONDANGKYPO d on tk.MADDKPO = d.MADDKPO
		where hi.MOTATTDON = 'DUYETTHIETKE'

		update  HISNGAYDANGKYPO set SoNgay = 1
		from HISNGAYDANGKYPO hi inner join THIETKEPO tk on hi.MADDKPO = tk.MADDKPO 
			inner join DONDANGKYPO d on tk.MADDKPO = d.MADDKPO
		where tk.NGAYDTK < d.NGAYHKS and MOTATTDON = 'DUYETTHIETKE'

		update  HISNGAYDANGKYPO set SoNgay = (SELECT (DATEDIFF(dd, tk.NGAYDTK, ct.NGAYN) + 1) 
			- (DATEDIFF(wk, tk.NGAYDTK, ct.NGAYN) * 2) 
			- (CASE WHEN DATENAME(dw, tk.NGAYDTK) = 'Sunday' THEN 1 ELSE 0 END)
			- (CASE WHEN DATENAME(dw, ct.NGAYN) = 'Saturday' THEN 1 ELSE 0 END))
		from HISNGAYDANGKYPO hi inner join THIETKEPO tk on hi.MADDKPO = tk.MADDKPO
			inner join CHIETTINH ct on tk.MADDKPO = ct.MADDK
		where hi.MOTATTDON = 'DUYETCTKH'

		update  HISNGAYDANGKYPO set SoNgay = (SELECT (DATEDIFF(dd, ct.NGAYN, hd.NGAYTAO) + 1) 
			- (DATEDIFF(wk, ct.NGAYN, hd.NGAYTAO) * 2) 
			- (CASE WHEN DATENAME(dw, ct.NGAYN) = 'Sunday' THEN 1 ELSE 0 END)
			- (CASE WHEN DATENAME(dw, hd.NGAYTAO) = 'Saturday' THEN 1 ELSE 0 END))
		from HISNGAYDANGKYPO hi inner join CHIETTINH ct on hi.MADDKPO = ct.MADDK
			inner join HOPDONGPO hd on ct.MADDK = hd.MADDKPO
		where hi.MOTATTDON = 'INHOPDONG'

		update  HISNGAYDANGKYPO set SoNgay = 1
		from HISNGAYDANGKYPO hi inner join CHIETTINH ct on hi.MADDKPO = ct.MADDK
			inner join HOPDONGPO hd on ct.MADDK = hd.MADDKPO
		where hi.MOTATTDON = 'INHOPDONG' and hi.SoNgay < 0

		update  HISNGAYDANGKYPO set SoNgay = (SELECT (DATEDIFF(dd, hd.NGAYTAO, tc.NGAYHT) + 1) 
			- (DATEDIFF(wk, hd.NGAYTAO, tc.NGAYHT) * 2) 
			- (CASE WHEN DATENAME(dw, hd.NGAYTAO) = 'Sunday' THEN 1 ELSE 0 END)
			- (CASE WHEN DATENAME(dw, tc.NGAYHT) = 'Saturday' THEN 1 ELSE 0 END))
		from HISNGAYDANGKYPO hi inner join THICONG tc on hi.MADDKPO = tc.MADDK
			inner join HOPDONGPO hd on tc.MADDK = hd.MADDKPO
			inner join CHIETTINH ct on tc.MADDK = ct.MADDK
		where hi.MOTATTDON = 'DUYETTHICONG'

		update  HISNGAYDANGKYPO set SoNgay = (SELECT (DATEDIFF(dd, tc.NGAYHT, bb.NGAYLAPBB) + 1) 
			- (DATEDIFF(wk, tc.NGAYHT, bb.NGAYLAPBB) * 2) 
			- (CASE WHEN DATENAME(dw, tc.NGAYHT) = 'Sunday' THEN 1 ELSE 0 END)
			- (CASE WHEN DATENAME(dw, bb.NGAYLAPBB) = 'Saturday' THEN 1 ELSE 0 END))
		from HISNGAYDANGKYPO hi inner join THICONG tc on hi.MADDKPO = tc.MADDK
			inner join BBNGHIEMTHUPO bb on tc.MADDK = bb.MADDKPO
		where hi.MOTATTDON = 'INBBNT'


	update Database table DONDANGKY, DONDANGKYPO =>
		update DONDANGKY set NGAYDK = NGAYN where NGAYDK is null
		update DONDANGKY set NGAYHKS = tk.NGAYDTK
			from DONDANGKY d inner join THIETKE tk on d.MADDK = tk.MADDK where d.NGAYHKS is null
		update DONDANGKYPO set NGAYDK = NGAYN where NGAYDK is null
		update DONDANGKYPO set NGAYHKS = tk.NGAYDTK
			from DONDANGKYPO d inner join THIETKEPO tk on d.MADDKPO = tk.MADDKPO where d.NGAYHKS is null

	update Database table THIETKE, THIETKEPO => 
		update THIETKE set NGAYLTK = NGAYN where ngayltk is null
		update THIETKEPO set NGAYLTK = NGAYN where ngayltk is null
	
	


	insert table in Database: BBNghiemThuHis
	insert table in Database: BBNghiemThuPoHis
	insert Table in Database: ChietTinhHis
	insert Table in Database: HopDongHis
	insert Table in Database: HopDongPoHis
	insert Table in Database: HisNgayDangKyHis
	insert Table in Database: HisNgayDangKyPoHis
	insert Table in Database: ThietKePoHis


	install .NET Framwork 4.6.1


	select 'Ok' as KetQua	

-- diff Saturday and sunday
DECLARE @StartDate DATETIME
DECLARE @EndDate DATETIME
SET @StartDate = '2020/10/29'
SET @EndDate = '2020/11/03'

SELECT (DATEDIFF(dd, @StartDate, @EndDate) + 1) 
	- (DATEDIFF(wk, @StartDate, @EndDate) * 2) 
	- (CASE WHEN DATENAME(dw, @StartDate) = 'Sunday' THEN 1 ELSE 0 END)
	- (CASE WHEN DATENAME(dw, @EndDate) = 'Saturday' THEN 1 ELSE 0 END)

	//DateTime tungay = DateTimeUtil.GetVietNamDate(txtTuNgay.Text.Trim());
            //DateTime denngay = DateTimeUtil.GetVietNamDate(txtDenNgay.Text.Trim());
            //if (tungay <= denngay)
            //{
            //    int songay = DateTimeUtil.CountDayDiffT7CN(tungay, denngay);
            //}
            //else 
            //{
            //    ShowError("Chọn từ ngày đến ngày cho đúng.");
            //}
            //CloseWaitingDialog();

	//lbSoNgayLamHoSo.Text = dondangky.NGAYDK != null && dondangky.NGAYHKS != null ?
                                //    Convert.ToString(DateTimeUtil.CountDayDiffT7CN(dondangky.NGAYDK ?? DateTime.Now,
                                //    dondangky.NGAYHKS ?? DateTime.Now)) : "0";


r2	create procedure [dbo].[Get_DuongPho_ByAll]
r2	create procedure [dbo].[Get_DSTongHopKHDK_ByKVToNgay]	
r2	create procedure [dbo].[Get_DSTongHopKHDKPO_ByKVToNgay]
 
r2	update procedure [dbo].[BienKHNuoc]
r2	update procedure [dbo].[dsKHCBiKT]
r2	update procedure [dbo].[DSKHMOIDOTIN]	
r2	update procedure [dbo].[DSTHAYDOICHITIETNUOC]
r2	update procedure [dbo].[DSTHAYDOICHITIETNUOCDOTIN]
r2	update procedure [dbo].[HisBienCo]



